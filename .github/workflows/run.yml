name: Fetch Xray Config

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - name: Download Xray Config
        run: |
          curl -s "https://raw.githubusercontent.com/MahsaNetConfigTopic/config/refs/heads/main/xray_final.txt" -o config.txt

      - name: Send Config to Telegram
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            MODE="Manual ğŸ› "
          else
            MODE="Scheduled â°"
          fi

          NEXT_RUN=$(date -d "+30 min" '+%Y-%m-%d %H:%M')

          # Ø³Ø§Ø®Øª Caption Ø¨Ø§ printf Ùˆ escape Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø§Øµ
          CAPTION=$(printf "ğŸ“Œ *Xray Config Update*\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘ *Mode:* %s\nâ•‘ *Next Update:* %s\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•" "$MODE" "$NEXT_RUN")

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TOKEN }}/sendDocument" \
            -F chat_id="${{ secrets.CHAT_ID }}" \
            -F document=@config.txt \
            -F caption="$CAPTION" \
            -F parse_mode="Markdown"
