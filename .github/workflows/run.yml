name: Fetch Xray Config

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */2 * * *"   # Ù‡Ø± Û±Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - name: Download Xray Config
        run: |
          curl -s "https://raw.githubusercontent.com/MahsaNetConfigTopic/config/refs/heads/main/xray_final.txt" -o config.txt

      - name: Send Config to Telegram
        run: |
          # ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒØ²ÙˆÙ† Ø§ÛŒØ±Ø§Ù†
          export TZ="Asia/Tehran"

          # ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ø§Ø¬Ø±Ø§
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            MODE="Manual ğŸ› "
          else
            MODE="Auto â°"
          fi

          # Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ (Û±Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡â€ŒØ§ÛŒ)
          NOW=$(date '+%Y-%m-%d %H:%M')
          NEXT_RUN=$(date -d "+2 hours" '+%Y-%m-%d %H:%M')

          # Ú©Ù¾Ø´Ù† Ø´ÛŒÚ©ØŒ Ø¨ÙˆÙ„Ø¯ØŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒ
          CAPTION=$(printf "ğŸ“¦ *Xray Config Update*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ§­ *Mode:* %s\nğŸ•’ *Sent:* %s (IR)\nâ­ *Next:* %s (IR)\n ğŸ›¢ï¸*Source:* MashaNet\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”" \
          "$MODE" "$NOW" "$NEXT_RUN")

          # Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TOKEN }}/sendDocument" \
            -F chat_id="${{ secrets.CHAT_ID }}" \
            -F document=@config.txt \
            -F caption="$CAPTION" \
            -F parse_mode="Markdown"
