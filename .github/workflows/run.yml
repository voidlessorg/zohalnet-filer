name: Fetch Xray Config

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - name: Download Xray Config
        run: |
          curl -s "https://raw.githubusercontent.com/MahsaNetConfigTopic/config/refs/heads/main/xray_final.txt" -o config.txt

      - name: Send Config to Telegram
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            MODE="Manual ğŸ› "
          else
            MODE="Scheduled â°"
          fi

          NEXT_RUN=$(date -d "+30 min" '+%Y-%m-%d %H:%M')

          # Ø³Ø§Ø®Øª Caption Ø¨Ø§ Ú©Ø§Ø¯Ø±ØŒ Ø¨ÙˆÙ„Ø¯ Ùˆ Ø§ÛŒÙ…ÙˆØ¬ÛŒ
          CAPTION=$(printf "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n\
*ğŸ“Œ Xray Config Update*\n\
â•‘ *Mode:* %s\n\
â•‘ *Next Update:* %s\n\
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" "$MODE" "$NEXT_RUN")

          # Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ø§ MarkdownV2
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TOKEN }}/sendDocument" \
            -F chat_id="${{ secrets.CHAT_ID }}" \
            -F document=@config.txt \
            -F caption="$CAPTION" \
            -F parse_mode="Markdown"
