name: Fetch Xray Config (MCI)

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */2 * * *"   # Ÿáÿ± €≤ ÿ≥ÿßÿπÿ™


jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - name: Download Xray Config
        run: |
          curl -s "https://raw.githubusercontent.com/mahsanet/MahsaFreeConfig/main/mci/sub_2.txt"
      - name: Send Config to Telegram
        env:
          BOT_TOKEN: ${{ secrets.TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          export TZ=Asia/Tehran

          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            MODE="Manual üõ†"
          else
            MODE="Auto ‚è∞"
          fi

          NOW=$(date '+%Y-%m-%d %H:%M')
          NEXT_RUN=$(date -d "+2 hours" '+%Y-%m-%d %H:%M')

          CAPTION=$(printf "üì¶ *MCI Config Update*\nüß© *Source: @FreeVPNHomes* \nüß≠* Mode: %s*\nüïí *Sent: %s IR\n‚è≠ Next: %s IR*\n2Ô∏è‚É£*Filterfight II*" \
          "$MODE" "$NOW" "$NEXT_RUN")


          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendDocument" \
            -F chat_id="${CHAT_ID}" \
            -F document=@MCIconfig.txt \
            -F caption="$CAPTION" \
            -F parse_mode=Markdown
